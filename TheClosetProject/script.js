function navigateTo(page){window.location.href=page+'.html'}function initializeHexbin(containerId){const container=d3.select(`#${containerId}`);const width=300;const height=100;const data=[{x:50,y:30,value:1},{x:100,y:40,value:2},{x:150,y:35,value:1.5},{x:200,y:50,value:1},{x:250,y:45,value:2.5},{x:80,y:60,value:1.2},{x:120,y:70,value:1.8},{x:180,y:65,value:1.3}];const svg=container.append("svg").attr("width",width).attr("height",height);const hexbin=d3.hexbin().radius(8).extent([[0,0],[width,height]]);const bins=hexbin(data);const colorScale=d3.scaleLinear().domain([0,d3.max(bins,d=>d.length)]).range(["#111","#fff"]);svg.append("g").selectAll("path").data(bins).enter().append("path").attr("d",hexbin.hexagon()).attr("transform",d=>`translate(${d.x},${d.y})`).attr("fill",d=>colorScale(d.length)).attr("stroke","rgba(255,255,255,0.1)").attr("stroke-width",0.5).style("opacity",0.8)}function setupMapHandlers(){const modal=document.getElementById('map-modal');const closeBtn=document.getElementById('map-close');const svg=d3.select('#map-svg');let worldDataCache=null;function openModal(){modal.style.display='flex'}function closeModal(){modal.style.display='none';svg.selectAll('*').remove()}closeBtn.addEventListener('click',closeModal);modal.addEventListener('click',(e)=>{if(e.target===modal)closeModal()});const itemSlots=document.querySelectorAll('.item-slot[data-lat][data-lng]');itemSlots.forEach(slot=>{slot.addEventListener('click',async()=>{const lat=parseFloat(slot.getAttribute('data-lat'));const lng=parseFloat(slot.getAttribute('data-lng'));const name=slot.getAttribute('data-name')||'';openModal();const{width,height}=svg.node().getBoundingClientRect();const projection=d3.geoNaturalEarth1().translate([width/2,height/2]).scale(Math.min(width,height)*0.28);const path=d3.geoPath(projection);if(!worldDataCache){const world=await fetch('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json').then(r=>r.json());worldDataCache=topojson.feature(world,world.objects.countries)}svg.selectAll('*').remove();const locationNames={'ABERCROMBIE SHIRT':'Tracy, CA','CARHART JACKET':'Tokyo, Japan','GOLF JACKET':'Fairfax, Los Angeles, CA','NEPO BABY SHIRT':'Oakland, CA','NIKE WINDBREAKER':'Tokyo, Japan','VARSITY JACKET':'Orange County, CA','BIGGIE JEANS':'San Jose, CA','GREEN TRACKS':'Kyoto, Japan','OVERALLS':'Los Angeles, CA','SKULL JEANS':'Tokyo, Japan','ASICS':'Los Angeles, CA','GOTHIC DOCS':'San Francisco, CA','HIKING BOOTS':'Milpitas, CA','JORDANS 4':'Ontario, Canada','LOAFER DOCS':'Los Angeles, CA','BANANA HAT':'Orlando, FL','BASS PRO HAT':'San Jose, CA','JAKE HAT':'Milpitas, CA','NY HAT':'Downtown LA, CA','SPIDER HAT':'Anaheim, CA','TEEZO SKI':'San Francisco, CA','CHOPPER PLUSH':'San Jose, CA','JAPAN NECKLACE':'Kyoto, Japan','JAPAN RING':'Tokyo, Japan','NINTENDO 3DS':'Milpitas, CA','PHILIPPINES BRACELET':'Quezon City, Philippines','SILVER WATCH':'Milpitas, CA'};svg.append('text').attr('x',16).attr('y',24).attr('fill','#fff').attr('font-size',14).attr('font-family','IBM Plex Mono, monospace').attr('font-weight','500').text(locationNames[name]||name);svg.append('g').selectAll('path').data(worldDataCache.features).enter().append('path').attr('d',path).attr('fill','#0f0f0f').attr('stroke','rgba(255,255,255,0.15)').attr('stroke-width',0.5);const[x,y]=projection([lng,lat]);svg.append('circle').attr('cx',x).attr('cy',y).attr('r',5).attr('fill','#fff');svg.append('text').attr('x',x+8).attr('y',y-8).attr('fill','#fff').attr('font-size',12).attr('font-family','IBM Plex Mono, monospace').text(name)})})}document.addEventListener('DOMContentLoaded',function(){const hexbins=document.querySelectorAll('[id^="hexbin-"]');hexbins.forEach((el,i)=>initializeHexbin(`hexbin-${i+1}`));setupMapHandlers()});

